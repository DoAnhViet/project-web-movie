@model WebMovie.Models.MovieListResponse
@{
    var slug = ViewBag.CategorySlug as string;

    // Prefer controller-provided CategoryName (mimic Country page behavior)
    var categoryName = ViewBag.CategoryName as string;

    if (string.IsNullOrEmpty(categoryName))
    {
        // Nếu controller chưa cung cấp, gọi helper chung
        categoryName = WebMovie.Helpers.CategoryNames.GetDisplayName(slug);
    }

    ViewData["Title"] = categoryName;
}

<div class="container mt-4">
    <h2 class="text-center mb-5 fw-bold text-white">@ViewData["Title"]</h2>

    @* Debug helper: show slug and item count when no movies found *@
    @if ((Model?.Items == null || !Model.Items.Any()) && !string.IsNullOrEmpty(slug))
    {
        <div class="alert alert-warning">
            <strong>Không tìm thấy phim nào cho thể loại:</strong> <em>@(slug)</em>
        </div>
    }

    <!-- Bộ lọc đã được loại bỏ — trang hiển thị danh sách phim theo thể loại đã chọn -->

    <!-- Danh sách phim -->
    <div class="row">
        @if (Model?.Items != null && Model.Items.Any())
        {
            var itemsToShow = Model.Items.Take(18);
            foreach (var movie in itemsToShow)
            {
                <div class="col-lg-2 col-md-3 col-sm-4 col-6 movie-card">
                    <a href="/Movie/Detail?slug=@movie.Slug">
                        <div class="position-relative">
                            <img src="@movie.PosterUrl" alt="@movie.Name" loading="lazy" class="img-fluid rounded" />
                            @if (!string.IsNullOrEmpty(movie.Quality))
                            {
                                <span class="badge bg-warning text-dark position-absolute top-0 start-0 m-2">@movie.Quality</span>
                            }
                            @if (!string.IsNullOrEmpty(movie.EpisodeCurrent))
                            {
                                <span class="badge bg-danger position-absolute top-0 end-0 m-2">@movie.EpisodeCurrent</span>
                            }
                        </div>
                        <div class="movie-title mt-2 fw-semibold">@movie.Name</div>
                        @if (!string.IsNullOrEmpty(movie.OriginName))
                        {
                            <div class="text-muted small">@movie.OriginName</div>
                        }
                    </a>
                </div>
            }
        }
        else
        {
            <div class="col-12 text-center py-5">
                <i class="fas fa-film fa-3x text-muted mb-3"></i>
                <h4 class="text-muted">Không tìm thấy phim nào</h4>
            </div>
        }
    </div>

    <!-- Phân trang -->
    @if (Model?.Pagination != null && Model.Pagination.TotalPages > 1)
    {
        var pagination = Model.Pagination;
        <div class="pagination-container text-center mt-4">
            <ul class="pagination justify-content-center">
                @if (pagination.CurrentPage > 1)
                {
                    <li class="page-item">
                        <a class="page-link" href="?page=@(pagination.CurrentPage - 1)">
                            <i class="fas fa-chevron-left"></i> Trước
                        </a>
                    </li>
                }

                @for (int i = Math.Max(1, pagination.CurrentPage - 2);
                     i <= Math.Min(pagination.TotalPages, pagination.CurrentPage + 2);
                     i++)
                {
                    <li class="page-item @(i == pagination.CurrentPage ? "active" : "")">
                        <a class="page-link" href="?page=@i">@i</a>
                    </li>
                }

                @if (pagination.CurrentPage < pagination.TotalPages)
                {
                    <li class="page-item">
                        <a class="page-link" href="?page=@(pagination.CurrentPage + 1)">
                            Sau <i class="fas fa-chevron-right"></i>
                        </a>
                    </li>
                }
            </ul>
        </div>
    }
</div>
